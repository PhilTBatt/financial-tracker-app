<section class="data-section">
    <h1 class="heading">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-column-icon lucide-chart-column"><path d="M3 3v16a2 2 0 0 0 2 2h16"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
        Data Overview
    </h1>

    <div class="small-cards">
        <styled-card class="small-card">
            <p class="small-card-heading">
                Average Monthly Spend
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-icon lucide-calendar"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
            </p>
            <p class="small-card-text">
                @let avg = metrics?.avgMonthlySpend;

                {{avg != null ? '£' + (avg / 100) : ''}}
                <span class="small-cards-side-text">
                    {{metrics?.dateRangeLabel}}
                </span>
            </p>
        </styled-card>
        <styled-card class="small-card">
            <p class="small-card-heading">
                Total Transactions
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scroll-icon lucide-scroll"><path d="M19 17V5a2 2 0 0 0-2-2H4"/><path d="M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3"/></svg>
            </p>

            <p class="small-card-text">
                {{metrics?.totalTransactions}}
            </p>
        </styled-card>
        <styled-card class="small-card">
            <p class="small-card-heading">
                Top Spending Category
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart-icon lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
            </p>

            <p class="small-card-text">
                  @let top = (metrics?.categories?.outTotalByCategory | keyvalue:descValue)?.[0];
                {{ top?.key }}
                <span class="small-cards-side-text">
                    £{{ (top?.value ?? 0) / 100 }} Total
                </span>
            </p>
        </styled-card>
    </div>
    

    <div class="big-cards-section">
        <div class="big-cards">
            <styled-card class="big-card">
                <div class="big-card-heading">
                    <p class="big-card-heading-text">
                        Spend Over Time
                    </p>
                    <select class="chart-select" [(ngModel)]="lineMode" (change)="buildMonthlyOutLine()">
                        <option value="monthly">Monthly</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div class="chart montlhy-spend-chart">
                    @defer{<canvas baseChart [type]="lineType" [data]="lineData" [options]="lineOptions"></canvas>}
                </div>
            </styled-card>

            <styled-card class="big-card">
                <div class="big-card-heading">
                    <p class="big-card-heading-text">
                        Spend/Income Over Time
                    </p>
                    <select class="chart-select" [(ngModel)]="inOutMode" (change)="buildMonthlyInOutChart()">
                        <option value="monthly">Monthly</option>
                        <option value="weekly">Weekly</option>
                    </select>                    
                </div>
                <div class="chart in-out-chart">
                    @defer{<canvas baseChart [type]="inOutType" [data]="inOutData" [options]="inOutOptions"></canvas>}
                </div>
            </styled-card>
        </div>

        <div class="big-cards">
            <styled-card class="big-card">
                <div class="big-card-heading">
                    <p class="big-card-heading-text">
                        Category Distribution
                    </p>
                    <select class="chart-select" [(ngModel)]="donutMode" (change)="buildDonutChart()">
                        <option value="total">Total</option>
                        <option value="monthly">Monthly Avg</option>
                        <option value="weekly">Weekly Avg</option>
                    </select>  
                </div>
                <div class="chart donut-chart">
                    @defer{<canvas baseChart [type]="donutType" [data]="donutData" [options]="donutOptions"></canvas>}
                </div>
            </styled-card>

            <styled-card class="big-card">
                <p class="big-card-heading">
                    Category Spend
                </p>
                <div class="chart monthy-cat-spend-chart">
                    @defer{<canvas baseChart [type]="bubbleType" [data]="bubbleData" [options]="bubbleOptions"></canvas>}
                </div>
            </styled-card>
        </div>

        <div class="big-cards">
            <styled-card class="big-card">
                <div class="big-card-heading">
                    <p class="big-card-heading-text">
                        Spend Per Category
                    </p>
                    <select class="chart-select" [(ngModel)]="catStackMode" (change)="buildMonthlyCategoriesSpendChart()">
                        <option value="monthly">Monthly</option>
                        <option value="weekly">Weekly</option>
                    </select>                    
                </div>
                <div class="chart monthy-cat-spend-chart">
                    @defer{<canvas baseChart [type]="catStackType" [data]="catStackData" [options]="catStackOptions"></canvas>}
                </div>
            </styled-card>

            <styled-card class="big-card">
                <p class="big-card-heading">
                    Spend Across The Month
                </p>
                <div class="chart monthy-cat-spend-chart">
                    @defer{<canvas baseChart [type]="matrixType" [data]="matrixData" [options]="matrixOptions"></canvas>}
                </div>
            </styled-card>
        </div>

        <div class="small-cards small-cards-2">
            <styled-card class="small-card">
                <p class="small-card-heading">
                    Average Weekly Spend
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-icon lucide-calendar"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
                </p>
                <p class="small-card-text">
                    @let weeklyAvg = metrics?.avgWeeklySpend;

                    {{weeklyAvg != null ? '£' + (weeklyAvg / 100) : ''}}
                    <span class="small-cards-side-text">
                        {{metrics?.dateRangeLabel}}
                    </span>
                </p>
            </styled-card>
            <styled-card class="small-card">
                <p class="small-card-heading">
                    Average Transactions Per Day
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scroll-icon lucide-scroll"><path d="M19 17V5a2 2 0 0 0-2-2H4"/><path d="M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3"/></svg>
                </p>

                <p class="small-card-text">
                    @let transactions = metrics?.totalTransactions;
                    @let days = metrics?.daily?.labels?.length;
                    {{ (transactions != null && days != null && days > 0) ? transactions / days : ''}}
                </p>
            </styled-card>
            <styled-card class="small-card">
                <p class="small-card-heading">
                    Average Spend Amount
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart-icon lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                </p>

                <p class="small-card-text">
                    £{{ (avgOutgoingTransaction ?? 0) / 100 | number:'1.2-2' }}
                    <span class="small-cards-side-text">
                        Per Transaction
                    </span>
                </p>
            </styled-card>
        </div>
    </div>

    <div class="big-cards-section">
        <div class="big-cards">
            <styled-card class="big-card">
                <p class="big-card-heading">
                    Average Spend Per Week Day
                </p>
                <div class="chart weekly-spend-chart">
                    @defer{<canvas baseChart [type]="weekdayType" [data]="weekdayData" [options]="weekdayOptions"></canvas>}
                </div>
            </styled-card>

            <styled-card class="big-card">
                <p class="big-card-heading">
                    Spending By Transaction Size
                </p>
                <div class="chart transaction-size-chart">
                    @defer{<canvas baseChart [type]="sizeType" [data]="sizeData" [options]="sizeOptions"></canvas>}
                </div>
            </styled-card>
        </div>

        <div class="big-cards">
            <styled-card class="big-card">
                <p class="big-card-heading">
                    Transactions Over Time
                </p>
                <div class="chart">
                    @defer{<canvas baseChart [type]="scatterType" [data]="scatterData" [options]="scatterOptions"></canvas>}
                </div>
            </styled-card>

            <styled-card class="big-card">
                <p class="big-card-heading">
                    Daily Spend Rolling 7-day Average
                </p>
                <div class="chart">
                    @defer{<canvas baseChart [type]="rollingType" [data]="rollingData" [options]="rollingOptions"></canvas>}
                </div>
            </styled-card>
        </div>
    </div>
</section>